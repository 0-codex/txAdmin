{{include("header")/}}


<div class="text-center mb-4">
    <h2>Resources List</h2>
</div>


<div class="row justify-content-md-center">
        <div class="col-md-7">
            <div class="card card-accent-primary">
                <div class="card-header float-left">
                    <span style="font-size: large">All Resources</span>
                    <button class="btn btn-sm btn-primary float-right" type="button" id="btnRefresh" {{disableActions}}>
                        <i class="icon-refresh"></i> Reload & Refresh
                    </button>
                    <input class="form-control" type="text" name="resource" id="resourceInput" onkeyup="findResource()"
                        placeholder="Find resource by name..." style="margin-top: 1em;">
                </div>
            </div>
        </div>
        <div class="card-columns" id="folderCards">



            {{foreach(options.resGroups)}}
            <div class="card card-accent-primary">
                <div class="card-header" data-toggle="collapse" href="#resList-cardBory-{{@this.divName}}" aria-expanded="true"
                    aria-controls="resList-cardBory-{{@this.divName}}" id="resList-cardHeader-{{@this.divName}}">
                    <span style="font-size: large">{{@this.subPath}}</span>
                    <i class="fa fa-chevron-down pull-right"></i>
                </div>
                <div class="card-body collapse show" id="resList-cardBory-{{@this.divName}}" aria-labelledby="resList-cardHeader-{{@this.divName}}">
                    {{each(@this.resources)}}
                    <div class="callout callout-{{@this.statusClass}} b-t-1 b-r-1 b-b-1" style="padding-top: 1em;">
                        <strong class="h4">{{@this.name}}</strong>
                        {{if(@this.status=='started')}}
                        <button class="btn btn-sm btn-outline-dark float-right"
                            onclick="btnCommand('ensure_res', '{{@this.name}}')" {{disableActions}}>
                            RESTART
                        </button>
                        &nbsp;
                        <button class="btn btn-sm btn-outline-dark float-right" style="margin-right: 0.5em;"
                            onclick="btnCommand('stop_res', '{{@this.name}}')" {{disableActions}}>
                            STOP
                        </button>
                        {{#else}}
                        <button class="btn btn-sm btn-outline-dark float-right"
                            onclick="btnCommand('ensure_res', '{{@this.name}}')" {{disableActions}}>
                            START
                        </button>
                        {{/if}}
                        <br>
                        <small class="text-muted">{{@this.version}} {{@this.author}}</small>
                    </div>
                    {{/each}}
                </div>
            </div>
            {{/foreach}}



        </div>
    </div>


{{include("footer")/}}




<script>
    //NOTE: breaking multiple lines because squirrelly is not respecting LF as line endings.
    //Change squirrelly tag: {{tags(--,--)/}}
    //intentionally 'blank' line
    const resGroupsJS =  --resGroupsJS|safe--
    //Changing it back: --tags({{,}})/--
    //intentionally 'blank' line


    //============================================== Refresh List
    $('#btnRefresh').click(function () {
        var notify = $.notify({ message: '<p class="text-center">Executing Command...</p>' }, {});
        $.ajax({
            type: "POST",
            url: '/fxCommands',
            timeout: 2000,
            data: {action: 'refresh_res', parameter: ''},
            success: function (data) {
                window.location.reload(true);
                // notify.update('progress', 0);
                // notify.update('type', data.type);
                // notify.update('message', data.message);
            },
            error: function (xmlhttprequest, textstatus, message) {
                notify.update('progress', 0);
                notify.update('type', 'danger');
                notify.update('message', message);
            }
        });
    })


    //EXECUTE button handler
    function btnCommand(action, parameter){
        var notify = $.notify({ message: '<p class="text-center">Executing Command...</p>' }, {});
        $.ajax({
            type: "POST",
            url: '/fxCommands',
            timeout: 2000,
            data: {action, parameter},
            success: function (data) {
                window.location.reload(true);
                // notify.update('progress', 0);
                // notify.update('type', data.type);
                // notify.update('message', data.message);
            },
            error: function (xmlhttprequest, textstatus, message) {
                notify.update('progress', 0);
                notify.update('type', 'danger');
                notify.update('message', message);
            }
        });
    }
</script>
