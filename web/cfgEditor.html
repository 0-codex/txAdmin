{{include("header")/}}

<!-- Page CSS -->
<link rel="stylesheet" href="css/codemirror.css">
<link rel="stylesheet" href="css/codemirror_lucario.css">
<style>
    .cm-s-lucario{
        font-size: 1.05rem !important;
    }
    .CodeMirror{
        height: calc(100vh - 250px);
    }
</style>

<!-- Title -->
<div class="text-center mb-4">
    <h3>Server Config File Editor</h3>
</div>

<!-- CFG Editor -->
<div class="row justify-content-md-center">
    <div class="col-lg-12 col-xl-10">
        <textarea id="code-markdown" style="height: calc(100vh - 348px);"
            class="cms-s-lucario" name="code">{{rawFile}}</textarea>
    </div>
</div>
<div class="row justify-content-md-center" style="margin-top: 1em;">
        <div class="mx-auto">
            <button type="button" id="cfgEditor-save" class="btn btn-outline-dark btn-sm mb-2">Save File</button>
        </div>
</div>


{{include("footer")/}}


<script src="js/codeEditor/codemirror.js"></script>
<script src="js/codeEditor/mode/nginx.js"></script>
<script>
    //============================================== CodeMirror Setup
    window.onload = function () {
        var te_markdown = document.getElementById("code-markdown");

        window.editor_markdown = CodeMirror.fromTextArea(te_markdown, {
            mode: "text/x-nginx-conf",
            lineNumbers: true,
            lineWrapping: true,
            theme: "lucario"
        });
    };


    //============================================== Save action
    $('#cfgEditor-save').click(function () {
        let cfgData = window.editor_markdown.getValue();
        if(cfgData.length < 1024){
            var notify = $.notify({ message: `Your CFG file is too small, there is a good chance you deleted something you shouldn't.` }, { type: 'warning' });
            return;
        }
        var notify = $.notify({ message: '<p class="text-center">Saving...</p>' }, {});

        $.ajax({
            type: "POST",
            url: '/cfgEditor/save',
            timeout: 2000,
            data: {cfgData},
            dataType: 'json',
            success: function (data) {
                notify.update('progress', 0);
                notify.update('type', data.type);
                notify.update('message', data.message);
            },
            error: function (xmlhttprequest, textstatus, message) {
                notify.update('progress', 0);
                notify.update('type', 'danger');
                notify.update('message', message);
            }
        });
    });
</script>
